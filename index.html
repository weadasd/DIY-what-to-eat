<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯å‘¨èœå•è§„åˆ’ Â· ç¾é£ŸåŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #10b981;
            --primary-light: #d1fae5;
            --primary-dark: #059669;
            --secondary-color: #f3f4f6;
            --accent-color: #f59e0b;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            --border-color: #e5e7eb;
            --card-bg: #ffffff;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            color: var(--text-primary);
            background: linear-gradient(135deg, #f0fdf4 0%, #e0f2fe 100%);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            position: sticky;
            top: 0;
            background: var(--card-bg);
            box-shadow: var(--shadow-md);
            z-index: 100;
            transition: var(--transition);
        }

        .header-content {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 20px;
            color: var(--primary-dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header h1::before {
            content: "ğŸ³";
            font-size: 24px;
        }

        /* åº•éƒ¨å¯¼èˆªæ ‡ç­¾ */
        .nav-tabs {
            display: flex;
            justify-content: space-around;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 8px 0;
        }

        .nav-tab {
            flex: 1;
            padding: 12px 8px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 12px;
            color: var(--text-secondary);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            position: relative;
        }

        .nav-tab::before {
            content: attr(data-icon);
            font-size: 20px;
            display: block;
        }

        .nav-tab.active {
            color: var(--primary-color);
        }

        .nav-tab.active::after {
            content: "";
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .content {
            padding: 20px;
            min-height: calc(100vh - 180px);
        }

        .tab-content {
            display: none;
            animation: slideUp 0.3s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-icon {
            padding: 8px;
            border-radius: 50%;
            width: 36px;
            height: 36px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: var(--transition);
            background: var(--card-bg);
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--secondary-color);
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }

        td {
            font-size: 14px;
        }

        /* èœå“å¡ç‰‡ */
        .dish-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .dish-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .dish-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(240px, 1fr));
            gap: 16px;
        }

        .dish-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--secondary-color);
        }

        .dish-content {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }

        .dish-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .dish-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .dish-tag {
            padding: 4px 10px;
            background: var(--primary-light);
            color: var(--primary-dark);
            border-radius: 20px;
            font-size: 12px;
        }

        .dish-actions {
            display: flex;
            gap: 8px;
        }

        /* æ ‡ç­¾æ ·å¼ */
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .tag {
            padding: 6px 12px;
            background: var(--secondary-color);
            color: var(--text-secondary);
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .tag:hover {
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        .tag.selected {
            background: var(--primary-color);
            color: white;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideUp 0.3s ease-out;
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* æµ®åŠ¨æ·»åŠ æŒ‰é’® */
        .fab {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            font-size: 24px;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: var(--transition);
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-hint {
            font-size: 14px;
            color: var(--text-light);
        }

        /* Toastæç¤º */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            z-index: 2000;
            display: none;
            animation: toastFadeInOut 2s ease-in-out;
        }

        @keyframes toastFadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }

        /* èœå•å±•ç¤ºæ ·å¼ */
        .menu-day {
            background: var(--card-bg);
            border-radius: var(--radius);
            margin-bottom: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .menu-day-header {
            background: var(--primary-light);
            padding: 12px 16px;
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-day-content {
            padding: 16px;
        }

        .meal-section {
            margin-bottom: 16px;
        }

        .meal-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .meal-dishes {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .meal-dish {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            background: var(--secondary-color);
            border-radius: var(--radius-sm);
        }

        .meal-dish-image {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            object-fit: cover;
        }

        /* è´­ç‰©æ¸…å•æ ·å¼ */
        .category-section {
            margin-bottom: 24px;
        }

        .category-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ingredient-list {
            background: var(--card-bg);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .ingredient-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ingredient-item:last-child {
            border-bottom: none;
        }

        .ingredient-name {
            flex: 1;
            font-size: 14px;
        }

        .ingredient-quantity {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* é…ç½®é¢æ¿æ ·å¼ */
        .config-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
        }

        .config-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .config-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .config-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .config-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .switch.active {
            background: var(--primary-color);
        }

        .switch-handle {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .switch.active .switch-handle {
            transform: translateX(20px);
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (min-width: 768px) {
            .container {
                max-width: 768px;
                margin: 0 auto;
            }

            .content {
                padding: 30px;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ç‰¹æ®Šå…ƒç´ æ ·å¼ */
        .highlight {
            color: var(--primary-color);
            font-weight: 600;
        }

        .divider {
            height: 1px;
            background: var(--border-color);
            margin: 16px 0;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="header">
            <div class="header-content">
                <h1>æ¯å‘¨èœå•è§„åˆ’</h1>
                <button class="btn btn-icon btn-secondary" onclick="showSettings()">âš™ï¸</button>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="content">
            <!-- èœå“ç®¡ç† -->
            <div class="tab-content active" id="dishes">
                <div class="card">
                    <div class="card-header">
                        <span>æˆ‘çš„èœå“</span>
                        <span class="highlight" id="dishCount">0 é“èœ</span>
                    </div>
                    <div id="dishList"></div>
                </div>
            </div>

            <!-- å®¶åº­æˆå‘˜ -->
            <div class="tab-content" id="members">
                <div class="card">
                    <div class="card-header">
                        <span>å®¶åº­æˆå‘˜</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="highlight" id="memberCount">0 äºº</span>
                            <button class="btn btn-sm btn-primary" onclick="addMember()">æ·»åŠ æˆå‘˜</button>
                        </div>
                    </div>
                    <div id="membersList"></div>
                </div>
            </div>

            <!-- é…ç½®ä¸ç”Ÿæˆ -->
            <div class="tab-content" id="config">
                <div class="config-section">
                    <div class="config-title">ğŸ½ï¸ ç”¨é¤è®¾ç½®</div>
                    <div class="config-item">
                        <span class="config-label">ç”¨é¤äººæ•°</span>
                        <div class="config-control">
                            <select id="mealPeopleCount" onchange="updateDishCount()" style="width: auto;">
                                <option value="2">2äºº</option>
                                <option value="3" selected>3äºº</option>
                                <option value="4">4äºº</option>
                                <option value="5">5äºº</option>
                                <option value="6">6äºº</option>
                                <option value="custom">è‡ªå®šä¹‰</option>
                            </select>
                            <span id="customPeopleCount" style="display: none;">
                                <input type="number" id="customPeople" min="1" max="20" value="3" style="width: 60px;">äºº
                            </span>
                        </div>
                    </div>
                    <div class="config-item">
                        <span class="config-label">èœå“æ¨¡å¼</span>
                        <div class="config-control">
                            <select id="dishPattern" onchange="updateDishCount()" style="width: auto;">
                                <option value="2">2èœ1æ±¤</option>
                                <option value="3" selected>3èœ1æ±¤</option>
                                <option value="4">4èœ1æ±¤</option>
                                <option value="custom">è‡ªå®šä¹‰</option>
                            </select>
                            <span id="customPattern" style="display: none;">
                                <input type="number" id="customDish" min="1" max="10" value="3" style="width: 50px;">èœ
                                <input type="number" id="customSoup" min="0" max="5" value="1" style="width: 50px;">æ±¤
                            </span>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <div class="config-title">ğŸ“… ç”Ÿæˆé…ç½®</div>
                    <div class="config-item">
                        <span class="config-label">ç”Ÿæˆå¤©æ•°</span>
                        <div class="config-control">
                            <select id="generateDays" style="width: auto;">
                                <option value="3">3å¤©</option>
                                <option value="5" selected>5å¤©</option>
                                <option value="7">7å¤©</option>
                            </select>
                        </div>
                    </div>
                    <div class="config-item">
                        <span class="config-label">è¥å…»ä¸»é¢˜</span>
                        <div class="config-control">
                            <select id="nutritionTheme" style="width: auto;">
                                <option value="">å‡è¡¡è¥å…»</option>
                                <option value="high-protein">é«˜è›‹ç™½</option>
                                <option value="low-fat">ä½è„‚è‚ª</option>
                                <option value="vegetarian">ç´ é£Ÿä¸»ä¹‰</option>
                                <option value="light">æ¸…æ·¡é¥®é£Ÿ</option>
                            </select>
                        </div>
                    </div>
                    <div class="config-item">
                        <span class="config-label">å£å‘³åå¥½</span>
                        <div class="config-control">
                            <select id="tastePreference" style="width: auto;">
                                <option value="">ä¸é™</option>
                                <option value="spicy">éº»è¾£</option>
                                <option value="sweet">ç”œé²œ</option>
                                <option value="sour">é…¸çˆ½</option>
                                <option value="salty">å’¸é¦™</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <div class="config-title">ğŸš« é¿å¼€é£Ÿæ</div>
                    <input type="text" id="avoidIngredients" placeholder="è¾“å…¥ä¸éœ€è¦çš„é£Ÿæï¼Œç”¨é€—å·åˆ†éš”"
                           style="width: 100%; margin-bottom: 12px;">
                </div>

                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-primary" onclick="generateWeeklyMenu()" style="flex: 1;">
                        <span>âœ¨</span>
                        <span>ç”Ÿæˆèœå•</span>
                    </button>
                    <button class="btn btn-secondary" onclick="resetConfig()">
                        <span>ğŸ”„</span>
                        <span>é‡ç½®</span>
                    </button>
                </div>
            </div>

            <!-- æœ¬å‘¨èœå• -->
            <div class="tab-content" id="menu">
                <div id="weeklyMenuDisplay"></div>
            </div>

            <!-- è´­ç‰©æ¸…å• -->
            <div class="tab-content" id="shopping">
                <div id="shoppingListDisplay"></div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dishes" data-icon="ğŸ´">
                èœå“
            </button>
            <button class="nav-tab" data-tab="members" data-icon="ğŸ‘¥">
                æˆå‘˜
            </button>
            <button class="nav-tab" data-tab="config" data-icon="âš™ï¸">
                é…ç½®
            </button>
            <button class="nav-tab" data-tab="menu" data-icon="ğŸ“‹">
                èœå•
            </button>
            <button class="nav-tab" data-tab="shopping" data-icon="ğŸ›’">
                æ¸…å•
            </button>
        </div>
    </div>

    <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
    <button class="fab" onclick="handleFab()">+</button>

    <!-- èœå“æ¨¡æ€æ¡† -->
    <div class="modal" id="dishModal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="dishModalTitle">æ–°å¢èœå“</span>
                <button class="btn btn-icon" onclick="closeModal('dishModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="dishForm">
                    <div class="form-group">
                        <label>èœå“åç§° *</label>
                        <input type="text" id="dishName" required placeholder="ä¾‹å¦‚ï¼šå®«ä¿é¸¡ä¸">
                    </div>

                    <div class="form-group">
                        <label>èœå“å›¾ç‰‡</label>
                        <input type="text" id="dishImage" placeholder="ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆç²¾ç¾å›¾ç‰‡">
                    </div>

                    <div class="form-group">
                        <label>èœå“ç±»å‹ *</label>
                        <select id="dishType" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="meat">è¤èœ</option>
                            <option value="vegetable">ç´ èœ</option>
                            <option value="soup">æ±¤å“</option>
                            <option value="staple">ä¸»é£Ÿ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>å£å‘³æ ‡ç­¾</label>
                        <div class="tags" id="tasteTags">
                            <span class="tag" data-tag="è¾£">ğŸŒ¶ï¸ è¾£</span>
                            <span class="tag" data-tag="é…¸">ğŸ‹ é…¸</span>
                            <span class="tag" data-tag="ç”œ">ğŸ¯ ç”œ</span>
                            <span class="tag" data-tag="å’¸">ğŸ§‚ å’¸</span>
                            <span class="tag" data-tag="æ¸…æ·¡">ğŸ¥¬ æ¸…æ·¡</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>è¥å…»æ ‡ç­¾</label>
                        <div class="tags" id="nutritionTags">
                            <span class="tag" data-tag="é«˜è›‹ç™½">ğŸ’ª é«˜è›‹ç™½</span>
                            <span class="tag" data-tag="ä½è„‚è‚ª">ğŸ¥— ä½è„‚è‚ª</span>
                            <span class="tag" data-tag="é«˜çº¤ç»´">ğŸŒ¾ é«˜çº¤ç»´</span>
                            <span class="tag" data-tag="è¡¥é’™">ğŸ¥› è¡¥é’™</span>
                            <span class="tag" data-tag="è¡¥é“">ğŸ©¸ è¡¥é“</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>æ‰€éœ€é£Ÿæ *</label>
                        <textarea id="dishIngredients" placeholder="æ¯è¡Œä¸€ä¸ªé£Ÿæï¼Œä¾‹å¦‚ï¼š&#10;é¸¡è‚‰ 300g&#10;èŠ±ç”Ÿ 50g&#10;å¹²è¾£æ¤’ 10ä¸ª" required></textarea>
                    </div>

                    <div class="form-group">
                        <label>è°ƒå‘³å“</label>
                        <textarea id="dishCondiments" placeholder="æ¯è¡Œä¸€ä¸ªè°ƒå‘³å“ï¼Œä¾‹å¦‚ï¼š&#10;ç”ŸæŠ½ 2å‹º&#10;è€æŠ½ 1å‹º&#10;æ–™é…’ 1å‹º"></textarea>
                    </div>

                    <div class="form-group">
                        <label>çƒ¹é¥ªéš¾åº¦</label>
                        <select id="cookTimeLevel">
                            <option value="easy">ç®€å• (30åˆ†é’Ÿå†…)</option>
                            <option value="medium">ä¸­ç­‰ (30-60åˆ†é’Ÿ)</option>
                            <option value="hard">å¤æ‚ (60åˆ†é’Ÿä»¥ä¸Š)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>å¤‡æ³¨</label>
                        <textarea id="dishRemark" placeholder="çƒ¹é¥ªæŠ€å·§ã€æ³¨æ„äº‹é¡¹ç­‰"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('dishModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveDish()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æˆå‘˜æ¨¡æ€æ¡† -->
    <div class="modal" id="memberModal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="memberModalTitle">æ·»åŠ å®¶åº­æˆå‘˜</span>
                <button class="btn btn-icon" onclick="closeModal('memberModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="memberForm">
                    <div class="form-group">
                        <label>å§“å *</label>
                        <input type="text" id="memberName" required placeholder="ä¾‹å¦‚ï¼šå°æ˜">
                    </div>

                    <div class="form-group">
                        <label>èº«ä»½ *</label>
                        <select id="memberType" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="adult">æˆå¹´äºº</option>
                            <option value="child">å„¿ç«¥</option>
                            <option value="elder">è€äºº</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>å£å‘³åå¥½</label>
                        <div class="tags" id="memberTasteTags">
                            <span class="tag" data-tag="è¾£">ğŸŒ¶ï¸ çˆ±åƒè¾£</span>
                            <span class="tag" data-tag="é…¸">ğŸ‹ çˆ±åƒé…¸</span>
                            <span class="tag" data-tag="ç”œ">ğŸ¯ çˆ±åƒç”œ</span>
                            <span class="tag" data-tag="æ¸…æ·¡">ğŸ¥¬ åå¥½æ¸…æ·¡</span>
                            <span class="tag" data-tag="æµ·é²œ">ğŸ¦ å–œæ¬¢æµ·é²œ</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>å¿Œå£/è¿‡æ•</label>
                        <textarea id="memberAvoid" placeholder="ä¾‹å¦‚ï¼š&#10;æµ·é²œè¿‡æ•&#10;ä¸åƒé¦™èœ&#10;ä¸å–ç‰›å¥¶"></textarea>
                    </div>

                    <div class="form-group">
                        <label>ç‰¹æ®Šé¥®é£Ÿéœ€æ±‚</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="isVegetarian">
                                <label for="isVegetarian">ç´ é£Ÿä¸»ä¹‰</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="isHalal">
                                <label for="isHalal">æ¸…çœŸé¥®é£Ÿ</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="lowOil">
                                <label for="lowOil">å°‘æ²¹</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="lowSalt">
                                <label for="lowSalt">å°‘ç›</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>å¤‡æ³¨</label>
                        <textarea id="memberRemark" placeholder="å…¶ä»–éœ€è¦è¯´æ˜çš„äº‹é¡¹"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="deleteMemberBtn" style="display: none;" onclick="deleteMember()">åˆ é™¤</button>
                <button class="btn btn-secondary" onclick="closeModal('memberModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveMember()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ›¿æ¢èœå“æ¨¡æ€æ¡† -->
    <div class="modal" id="replaceModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>æ›¿æ¢èœå“</span>
                <button class="btn btn-icon" onclick="closeModal('replaceModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>æ›¿æ¢åŸå› </label>
                    <select id="replaceReason">
                        <option value="dontLike">ä¸å–œæ¬¢è¿™é“èœ</option>
                        <option value="ateRecently">æœ€è¿‘åˆšåƒè¿‡</option>
                        <option value="noIngredients">ç¼ºå°‘é£Ÿæ</option>
                        <option value="tooComplex">çƒ¹é¥ªå¤ªå¤æ‚</option>
                        <option value="other">å…¶ä»–åŸå› </option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨è¯´æ˜</label>
                    <textarea id="replaceNote" placeholder="è¯·è¯´æ˜å…·ä½“åŸå› æˆ–è¦æ±‚"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('replaceModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmReplace()">ç¡®è®¤æ›¿æ¢</button>
            </div>
        </div>
    </div>

    <!-- Toastæç¤º -->
    <div class="toast" id="toast"></div>

    <script>
        // å…¨å±€æ•°æ®å­˜å‚¨
        let dishes = [];
        let members = [];
        let weeklyMenu = [];
        let currentEditDishIndex = -1;
        let currentEditMemberIndex = -1;
        let currentReplaceIndex = -1;
        let currentTab = 'dishes';
        let dailyNeeds = {
            meat: 2,
            vegetable: 2,
            soup: 1,
            staple: 1
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½æœ¬åœ°æ•°æ®
            loadDataFromStorage();

            // å¦‚æœæ²¡æœ‰èœå“ï¼Œåˆå§‹åŒ–é¢„è®¾èœå“
            if (dishes.length === 0) {
                initializeDefaultDishes();
            }

            // åˆå§‹åŒ–æ ‡ç­¾åˆ‡æ¢
            initTabs();

            // åˆå§‹åŒ–æ ‡ç­¾é€‰æ‹©
            initTagSelection();

            // æ¸²æŸ“åˆå§‹æ•°æ®
            renderDishes();
            renderMembers();
            updateCounts();
        });

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function initTabs() {
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetId = this.dataset.tab;

                    // æ›´æ–°æ ‡ç­¾çŠ¶æ€
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentTab = targetId;

                    // æ›´æ–°å†…å®¹æ˜¾ç¤º
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(targetId).classList.add('active');

                    // ç‰¹æ®Šå¤„ç†
                    if (targetId === 'menu' && weeklyMenu.length > 0) {
                        renderWeeklyMenu();
                    } else if (targetId === 'shopping' && weeklyMenu.length > 0) {
                        renderShoppingList();
                    }
                });
            });
        }

        // åˆå§‹åŒ–æ ‡ç­¾é€‰æ‹©
        function initTagSelection() {
            document.querySelectorAll('.tags .tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
        }

        function handleFab() {
            if (currentTab === 'members') {
                addMember();
            } else {
                addDish();
            }
        }

        // è§„èŒƒåŒ–èœå“æ•°æ®ï¼Œé¿å…è„æ•°æ®å¯¼è‡´æ¸²æŸ“å¤±è´¥
        function normalizeDish(dish, index = 0) {
            return {
                name: dish.name || `æœªå‘½åèœå“${index + 1}`,
                image: dish.image || `https://picsum.photos/400/300?random=${Date.now() + index}`,
                type: dish.type || 'meat',
                ingredients: Array.isArray(dish.ingredients) ? dish.ingredients : [],
                condiments: Array.isArray(dish.condiments) ? dish.condiments : [],
                tasteTags: Array.isArray(dish.tasteTags) ? dish.tasteTags : [],
                nutritionTags: Array.isArray(dish.nutritionTags) ? dish.nutritionTags : [],
                cookTimeLevel: dish.cookTimeLevel || 'medium',
                remark: dish.remark || ''
            };
        }

        // å®‰å…¨è§£ææœ¬åœ°å­˜å‚¨ï¼Œé˜²æ­¢åæ•°æ®å¯¼è‡´é¡µé¢ç©ºç™½
        function safeParse(key) {
            const raw = localStorage.getItem(key);
            if (!raw) return null;
            try {
                return JSON.parse(raw);
            } catch (err) {
                console.warn(`${key} æ•°æ®æŸåï¼Œå·²æ¸…ç©º`, err);
                localStorage.removeItem(key);
                return null;
            }
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadDataFromStorage() {
            const savedDishes = safeParse('dishes');
            const savedMembers = safeParse('members');
            const savedMenu = safeParse('weeklyMenu');

            if (Array.isArray(savedDishes)) {
                dishes = savedDishes.map((d, i) => normalizeDish(d, i)).slice(0, 30);
            }
            if (Array.isArray(savedMembers)) {
                members = savedMembers;
            }
            if (Array.isArray(savedMenu)) {
                weeklyMenu = savedMenu;
            }
        }

        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveDataToStorage() {
            localStorage.setItem('dishes', JSON.stringify(dishes));
            localStorage.setItem('members', JSON.stringify(members));
            localStorage.setItem('weeklyMenu', JSON.stringify(weeklyMenu));
        }

        // æ›´æ–°è®¡æ•°
        function updateCounts() {
            document.getElementById('dishCount').textContent = `${dishes.length} é“èœ`;
            document.getElementById('memberCount').textContent = `${members.length} äºº`;
        }

        // æ˜¾ç¤ºToastæç¤º
        function showToast(message, duration = 2000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            toast.style.animation = 'toastFadeInOut ' + duration + 'ms ease-in-out';

            setTimeout(() => {
                toast.style.display = 'none';
            }, duration);
        }

        // æ‰“å¼€æ¨¡æ€æ¡†
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            document.body.style.overflow = '';

            // æ¸…ç©ºè¡¨å•
            if (modalId === 'dishModal') {
                document.getElementById('dishForm').reset();
                document.querySelectorAll('.tags .tag').forEach(tag => {
                    tag.classList.remove('selected');
                });
                currentEditDishIndex = -1;
            } else if (modalId === 'memberModal') {
                document.getElementById('memberForm').reset();
                document.querySelectorAll('#memberTasteTags .tag').forEach(tag => {
                    tag.classList.remove('selected');
                });
                currentEditMemberIndex = -1;
            }
        }

        // èœå“ç®¡ç†åŠŸèƒ½
        function addDish() {
            openModal('dishModal');
        }

        function editDish(index) {
            const dish = dishes[index];
            currentEditDishIndex = index;

            document.getElementById('dishModalTitle').textContent = 'ç¼–è¾‘èœå“';
            document.getElementById('dishName').value = dish.name;
            document.getElementById('dishImage').value = dish.image || '';
            document.getElementById('dishType').value = dish.type;
            document.getElementById('dishIngredients').value = dish.ingredients.join('\n');
            document.getElementById('dishCondiments').value = dish.condiments ? dish.condiments.join('\n') : '';
            document.getElementById('cookTimeLevel').value = dish.cookTimeLevel || 'medium';
            document.getElementById('dishRemark').value = dish.remark || '';

            // è®¾ç½®æ ‡ç­¾
            document.querySelectorAll('#tasteTags .tag').forEach(tag => {
                const tagValue = tag.dataset.tag;
                if (dish.tasteTags && dish.tasteTags.includes(tagValue)) {
                    tag.classList.add('selected');
                } else {
                    tag.classList.remove('selected');
                }
            });

            document.querySelectorAll('#nutritionTags .tag').forEach(tag => {
                const tagValue = tag.dataset.tag;
                if (dish.nutritionTags && dish.nutritionTags.includes(tagValue)) {
                    tag.classList.add('selected');
                } else {
                    tag.classList.remove('selected');
                }
            });

            openModal('dishModal');
        }

        function saveDish() {
            const name = document.getElementById('dishName').value.trim();
            if (!name) {
                showToast('è¯·è¾“å…¥èœå“åç§°');
                return;
            }

            const dishData = {
                name: name,
                image: document.getElementById('dishImage').value.trim() || `https://picsum.photos/400/300?random=${Date.now()}`,
                type: document.getElementById('dishType').value,
                ingredients: document.getElementById('dishIngredients').value.split('\n').filter(i => i.trim()),
                condiments: document.getElementById('dishCondiments').value.split('\n').filter(c => c.trim()),
                tasteTags: Array.from(document.querySelectorAll('#tasteTags .tag.selected')).map(t => t.dataset.tag),
                nutritionTags: Array.from(document.querySelectorAll('#nutritionTags .tag.selected')).map(t => t.dataset.tag),
                cookTimeLevel: document.getElementById('cookTimeLevel').value,
                remark: document.getElementById('dishRemark').value.trim()
            };

            const normalized = normalizeDish(dishData, dishes.length);

            if (currentEditDishIndex >= 0) {
                dishes[currentEditDishIndex] = normalized;
                showToast('èœå“å·²æ›´æ–°');
            } else {
                dishes.push(normalized);
                showToast('èœå“å·²æ·»åŠ ');
            }

            saveDataToStorage();
            renderDishes();
            updateCounts();
            closeModal('dishModal');
        }

        function deleteDish(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é“èœå—ï¼Ÿ')) {
                dishes.splice(index, 1);
                saveDataToStorage();
                renderDishes();
                updateCounts();
                showToast('èœå“å·²åˆ é™¤');
            }
        }

        function renderDishes() {
            const container = document.getElementById('dishList');

            if (dishes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ½ï¸</div>
                        <div class="empty-text">è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•èœå“</div>
                        <div class="empty-hint">ç‚¹å‡»å³ä¸‹è§’çš„ + æŒ‰é’®æ·»åŠ ç¬¬ä¸€é“èœ</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="dish-grid">
                    ${dishes.map((dish, index) => `
                        <div class="dish-card">
                            <img src="${dish.image}" alt="${dish.name}" class="dish-image" onerror="this.src='https://picsum.photos/400/300?random=${index}'">
                            <div class="dish-content">
                                <div class="dish-name">${dish.name}</div>
                                <div class="dish-meta">
                                    <span class="dish-tag">${getTypeLabel(dish.type)}</span>
                                    ${dish.tasteTags.map(tag => `<span class="dish-tag">${getTagLabel(tag)}</span>`).join('')}
                                    ${dish.cookTimeLevel ? `<span class="dish-tag">${getCookTimeLabel(dish.cookTimeLevel)}</span>` : ''}
                                </div>
                                <div class="dish-actions">
                                    <button class="btn btn-sm btn-primary" onclick="editDish(${index})">ç¼–è¾‘</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteDish(${index})">åˆ é™¤</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // æˆå‘˜ç®¡ç†åŠŸèƒ½
        function addMember() {
            openModal('memberModal');
        }

        function editMember(index) {
            const member = members[index];
            currentEditMemberIndex = index;

            document.getElementById('memberModalTitle').textContent = 'ç¼–è¾‘æˆå‘˜';
            document.getElementById('memberName').value = member.name;
            document.getElementById('memberType').value = member.type;
            document.getElementById('memberAvoid').value = member.avoid ? member.avoid.join('\n') : '';
            document.getElementById('memberRemark').value = member.remark || '';
            document.getElementById('isVegetarian').checked = member.isVegetarian || false;
            document.getElementById('isHalal').checked = member.isHalal || false;
            document.getElementById('lowOil').checked = member.lowOil || false;
            document.getElementById('lowSalt').checked = member.lowSalt || false;

            // è®¾ç½®æ ‡ç­¾
            document.querySelectorAll('#memberTasteTags .tag').forEach(tag => {
                const tagValue = tag.dataset.tag;
                if (member.tasteTags && member.tasteTags.includes(tagValue)) {
                    tag.classList.add('selected');
                } else {
                    tag.classList.remove('selected');
                }
            });

            openModal('memberModal');
        }

        function saveMember() {
            const name = document.getElementById('memberName').value.trim();
            if (!name) {
                showToast('è¯·è¾“å…¥æˆå‘˜å§“å');
                return;
            }

            const memberData = {
                name: name,
                type: document.getElementById('memberType').value,
                tasteTags: Array.from(document.querySelectorAll('#memberTasteTags .tag.selected')).map(t => t.dataset.tag),
                avoid: document.getElementById('memberAvoid').value.split('\n').filter(a => a.trim()),
                isVegetarian: document.getElementById('isVegetarian').checked,
                isHalal: document.getElementById('isHalal').checked,
                lowOil: document.getElementById('lowOil').checked,
                lowSalt: document.getElementById('lowSalt').checked,
                remark: document.getElementById('memberRemark').value.trim()
            };

            if (currentEditMemberIndex >= 0) {
                members[currentEditMemberIndex] = memberData;
                document.getElementById('deleteMemberBtn').style.display = 'none';
                showToast('æˆå‘˜ä¿¡æ¯å·²æ›´æ–°');
            } else {
                members.push(memberData);
                showToast('æˆå‘˜å·²æ·»åŠ ');
            }

            saveDataToStorage();
            renderMembers();
            updateCounts();
            closeModal('memberModal');
        }

        function deleteMember() {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¯¥æˆå‘˜å—ï¼Ÿ')) {
                members.splice(currentEditMemberIndex, 1);
                saveDataToStorage();
                renderMembers();
                updateCounts();
                closeModal('memberModal');
                showToast('æˆå‘˜å·²åˆ é™¤');
            }
        }

        function renderMembers() {
            const container = document.getElementById('membersList');

            if (members.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ‘¥</div>
                        <div class="empty-text">è¿˜æ²¡æœ‰æ·»åŠ å®¶åº­æˆå‘˜</div>
                        <div class="empty-hint">æ·»åŠ æˆå‘˜åå¯ä»¥ç”Ÿæˆæ›´é€‚åˆçš„èœå•</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = members.map((member, index) => `
                <div class="card">
                    <div class="card-header">
                        <span>${member.name} ${getTypeIcon(member.type)}</span>
                        <button class="btn btn-sm btn-secondary" onclick="editMember(${index})">ç¼–è¾‘</button>
                    </div>
                    <div style="font-size: 14px; color: var(--text-secondary);">
                        ${member.tasteTags.length > 0 ? `
                            <div style="margin-bottom: 8px;">
                                å£å‘³åå¥½ï¼š${member.tasteTags.map(tag => getTagLabel(tag)).join('ã€')}
                            </div>
                        ` : ''}
                        ${member.avoid.length > 0 ? `
                            <div style="margin-bottom: 8px;">
                                å¿Œå£ï¼š${member.avoid.join('ã€')}
                            </div>
                        ` : ''}
                        ${getSpecialDiet(member)}
                    </div>
                </div>
            `).join('');
        }

        // èœå•ç”ŸæˆåŠŸèƒ½
        function updateDishCount() {
            const peopleCount = document.getElementById('mealPeopleCount').value;
            const dishPattern = document.getElementById('dishPattern').value;

            // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰é€‰é¡¹
            document.getElementById('customPeopleCount').style.display =
                peopleCount === 'custom' ? 'inline' : 'none';
            document.getElementById('customPattern').style.display =
                dishPattern === 'custom' ? 'inline' : 'none';

            // æ ¹æ®äººæ•°å’Œæ¨¡å¼è°ƒæ•´æ¯æ—¥éœ€æ±‚
            let people = parseInt(peopleCount);
            if (peopleCount === 'custom') {
                people = parseInt(document.getElementById('customPeople').value);
            }

            if (dishPattern !== 'custom') {
                const dishNum = parseInt(dishPattern);
                dailyNeeds.meat = Math.ceil(dishNum / 2);
                dailyNeeds.vegetable = Math.floor(dishNum / 2);
                dailyNeeds.soup = 1;
            }
        }

        function generateWeeklyMenu() {
            if (dishes.length === 0) {
                showToast('è¯·å…ˆæ·»åŠ ä¸€äº›èœå“');
                return;
            }

            const days = parseInt(document.getElementById('generateDays').value);
            weeklyMenu = [];

            for (let i = 0; i < days; i++) {
                const dayMenu = generateDayMenu(i);
                weeklyMenu.push(dayMenu);
            }

            saveDataToStorage();
            showToast('èœå•å·²ç”Ÿæˆ');

            // åˆ‡æ¢åˆ°èœå•é¡µé¢
            document.querySelector('[data-tab="menu"]').click();
            renderWeeklyMenu();
        }

        function generateDayMenu(dayIndex) {
            // æŒ‰ç±»å‹åˆ†ç±»èœå“
            const meatDishes = dishes.filter(d => d.type === 'meat');
            const vegDishes = dishes.filter(d => d.type === 'vegetable');
            const soups = dishes.filter(d => d.type === 'soup');
            const staples = dishes.filter(d => d.type === 'staple');

            const fallbackSoup = soups.length ? [] : [{ name: 'è”¬èœè›‹èŠ±æ±¤', type: 'soup', image: 'https://picsum.photos/120/80?random=3001' }];
            const fallbackStaple = staples.length ? [] : [{ name: 'ç±³é¥­', type: 'staple', image: 'https://picsum.photos/120/80?random=3002' }];

            // éšæœºé€‰æ‹©èœå“
            const selectedMeat = getRandomItems(meatDishes, dailyNeeds.meat);
            const selectedVeg = getRandomItems(vegDishes, dailyNeeds.vegetable);
            const selectedSoup = getRandomItems(soups.length ? soups : fallbackSoup, dailyNeeds.soup);
            const selectedStaple = getRandomItems(staples.length ? staples : fallbackStaple, dailyNeeds.staple);

            return {
                date: getDateStr(dayIndex),
                lunch: [...selectedMeat.slice(0, 1), ...selectedVeg.slice(0, 1), selectedStaple[0]].filter(Boolean),
                dinner: [...selectedMeat.slice(1), ...selectedVeg.slice(1), selectedSoup[0]].filter(Boolean)
            };
        }

        function getRandomItems(array, count) {
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function getDateStr(dayIndex) {
            const today = new Date();
            const date = new Date(today);
            date.setDate(today.getDate() + dayIndex);
            const weekDays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            return `${weekDays[date.getDay()]} (${date.getMonth() + 1}/${date.getDate()})`;
        }

        function renderWeeklyMenu() {
            const container = document.getElementById('weeklyMenuDisplay');

            if (weeklyMenu.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <div class="empty-text">è¿˜æ²¡æœ‰ç”Ÿæˆèœå•</div>
                        <div class="empty-hint">å‰å¾€"é…ç½® & ç”Ÿæˆ"é¡µé¢ç”Ÿæˆæœ¬å‘¨èœå•</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = weeklyMenu.map((day, dayIndex) => `
                <div class="menu-day">
                    <div class="menu-day-header">
                        <span>${day.date}</span>
                        <button class="btn btn-sm btn-secondary" onclick="regenerateDay(${dayIndex})">é‡æ–°ç”Ÿæˆ</button>
                    </div>
                    <div class="menu-day-content">
                        <div class="meal-section">
                            <div class="meal-title">
                                <span>â˜€ï¸</span>
                                <span>åˆé¤</span>
                            </div>
                            <div class="meal-dishes">
                                ${day.lunch.map(dish => renderDishItem(dish, dayIndex, 'lunch')).join('')}
                            </div>
                        </div>
                        <div class="meal-section">
                            <div class="meal-title">
                                <span>ğŸŒ™</span>
                                <span>æ™šé¤</span>
                            </div>
                            <div class="meal-dishes">
                                ${day.dinner.map(dish => renderDishItem(dish, dayIndex, 'dinner')).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderDishItem(dish, dayIndex, mealType) {
            const dishData = dishes.find(d => d.name === dish.name);
            const image = dishData ? dishData.image : `https://picsum.photos/100/100?random=${Math.random()}`;

            return `
                <div class="meal-dish">
                    <img src="${image}" alt="${dish.name}" class="meal-dish-image">
                    <span style="flex: 1;">${dish.name}</span>
                    <button class="btn btn-sm btn-secondary" onclick="replaceDish(${dayIndex}, '${mealType}', '${dish.name}')">æ›¿æ¢</button>
                </div>
            `;
        }

        function replaceDish(dayIndex, mealType, dishName) {
            currentReplaceIndex = { dayIndex, mealType, dishName };
            openModal('replaceModal');
        }

        function confirmReplace() {
            // è¿™é‡Œå¯ä»¥å®ç°æ›¿æ¢é€»è¾‘
            closeModal('replaceModal');
            showToast('èœå“å·²æ›¿æ¢');
            renderWeeklyMenu();
        }

        function regenerateDay(dayIndex) {
            weeklyMenu[dayIndex] = generateDayMenu(dayIndex);
            saveDataToStorage();
            renderWeeklyMenu();
            showToast(`${weeklyMenu[dayIndex].date} çš„èœå•å·²é‡æ–°ç”Ÿæˆ`);
        }

        // è´­ç‰©æ¸…å•åŠŸèƒ½
        function renderShoppingList() {
            const container = document.getElementById('shoppingListDisplay');

            if (weeklyMenu.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ›’</div>
                        <div class="empty-text">è¿˜æ²¡æœ‰è´­ç‰©æ¸…å•</div>
                        <div class="empty-hint">å…ˆç”Ÿæˆèœå•åè‡ªåŠ¨ç”Ÿæˆè´­ç‰©æ¸…å•</div>
                    </div>
                `;
                return;
            }

            // ç»Ÿè®¡æ‰€æœ‰é£Ÿæ
            const ingredients = {};
            weeklyMenu.forEach(day => {
                [...day.lunch, ...day.dinner].forEach(dish => {
                    const dishData = dishes.find(d => d.name === dish.name);
                    if (dishData) {
                        dishData.ingredients.forEach(ingredient => {
                            const name = ingredient.split(/[0-9]/)[0].trim();
                            const match = ingredient.match(/(\d+)/);
                            const quantity = match ? match[1] : 'é€‚é‡';

                            if (ingredients[name]) {
                                ingredients[name] = mergeQuantity(ingredients[name], quantity);
                            } else {
                                ingredients[name] = quantity;
                            }
                        });
                    }
                });
            });

            // ç®€å•çš„å¸‚åœºä»·ä¼°ç®—ï¼ˆå…ƒ/ä»½æˆ–å…ƒ/500gï¼‰
            const priceMap = {
                'é¸¡': 16, 'é¸­': 14, 'çŒªè‚‰': 18, 'äº”èŠ±è‚‰': 24, 'ç‰›': 36, 'ç¾Š': 32, 'è™¾': 30, 'é±¼': 24,
                'é‡Œè„Š': 22, 'é¸¡ç¿…': 22, 'é¸¡è…¿': 20, 'ç‰›è…©': 32, 'è‚¥ç‰›': 28,
                'åœŸè±†': 4, 'èŒ„å­': 5, 'é’æ¤’': 6, 'è¥¿çº¢æŸ¿': 6, 'é»„ç“œ': 4, 'è¥¿å…°èŠ±': 8, 'è èœ': 6,
                'èƒ¡èåœ': 4, 'æ´‹è‘±': 4, 'æœ¨è€³': 6, 'é¦™è‡': 10, 'ç´«èœ': 6, 'ç•ªèŒ„': 6, 'è±†è…': 4, 'é‡‘é’ˆè‡': 8,
                'ç±³': 4, 'é¢': 5, 'ç²‰ä¸': 5, 'é¸¡è›‹': 6
            };

            function classify(name) {
                const meatKeys = ['é¸¡', 'é¸­', 'ç‰›', 'çŒª', 'é±¼', 'è™¾', 'èŸ¹', 'è‚‰', 'è…©', 'ç¿…', 'è…¿', 'æ’'];
                const vegKeys = ['èœ', 'è±†', 'æ¤’', 'ç“œ', 'è‡', 'è¥¿å…°èŠ±', 'åœŸè±†', 'èŒ„å­', 'ç•ªèŒ„', 'è¥¿çº¢æŸ¿', 'è èœ', 'ç”Ÿèœ', 'ç´«èœ', 'é¦™è‡', 'æœ¨è€³', 'ç™½èœ', 'é’èœ', 'è¾£æ¤’'];
                if (meatKeys.some(k => name.includes(k))) return 'è¤èœ';
                if (vegKeys.some(k => name.includes(k))) return 'ç´ èœ';
                return 'å…¶ä»–';
            }

            function estimatePrice(name, quantity) {
                const key = Object.keys(priceMap).find(k => name.includes(k));
                const base = key ? priceMap[key] : 5;
                const numMatch = parseFloat(quantity);
                if (!isNaN(numMatch) && numMatch > 0) {
                    return Math.round(base * Math.min(numMatch, 5));
                }
                return base;
            }

            const grouped = { 'è¤èœ': [], 'ç´ èœ': [], 'å…¶ä»–': [] };
            for (const [name, quantity] of Object.entries(ingredients)) {
                const category = classify(name);
                const price = estimatePrice(name, quantity);
                grouped[category].push({ name, quantity, price });
            }

            let html = '';
            let total = 0;
            Object.entries(grouped).forEach(([category, list]) => {
                if (list.length === 0) return;
                const subtotal = list.reduce((s, item) => s + item.price, 0);
                total += subtotal;
                html += `
                    <div class="category-section">
                        <div class="category-header">
                            <span>${getCategoryIcon(category)}</span>
                            <span>${category}ï¼ˆä¼°ç®— Â¥${subtotal.toFixed(1)}ï¼‰</span>
                        </div>
                        <div class="ingredient-list">
                            ${list.map(item => `
                                <div class="ingredient-item">
                                    <span class="ingredient-name">${item.name}</span>
                                    <span class="ingredient-quantity">çº¦ Â¥${item.price.toFixed(1)}ï½œ${item.quantity}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            if (html) {
                html = `
                    <div class="category-section" style="border: none; padding: 0 0 12px 0; margin-bottom: 0;">
                        <div class="category-header">
                            <span>ğŸ§¾</span>
                            <span>æ€»è®¡ä¼°ç®—ï¼šÂ¥${total.toFixed(1)}</span>
                        </div>
                    </div>
                    ${html}
                `;
            }

            container.innerHTML = html || `
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“</div>
                    <div class="empty-text">æš‚æ— é£Ÿææ¸…å•</div>
                </div>
            `;
        }

        function mergeQuantity(q1, q2) {
            // ç®€å•çš„æ•°é‡åˆå¹¶é€»è¾‘
            if (q1 === 'é€‚é‡' || q2 === 'é€‚é‡') return 'é€‚é‡';
            const num1 = parseFloat(q1) || 0;
            const num2 = parseFloat(q2) || 0;
            const unit = q1.replace(/[0-9.]/g, '') || q2.replace(/[0-9.]/g, '') || '';
            return (num1 + num2) + unit;
        }

        // å·¥å…·å‡½æ•°
        function getTypeLabel(type) {
            const labels = {
                'meat': 'è¤èœ',
                'vegetable': 'ç´ èœ',
                'soup': 'æ±¤å“',
                'staple': 'ä¸»é£Ÿ'
            };
            return labels[type] || type;
        }

        function getTypeIcon(type) {
            const icons = {
                'adult': 'ğŸ‘¨',
                'child': 'ğŸ‘¦',
                'elder': 'ğŸ‘´'
            };
            return icons[type] || 'ğŸ‘¤';
        }

        function getTagLabel(tag) {
            const labels = {
                'è¾£': 'ğŸŒ¶ï¸ è¾£',
                'é…¸': 'ğŸ‹ é…¸',
                'ç”œ': 'ğŸ¯ ç”œ',
                'å’¸': 'ğŸ§‚ å’¸',
                'æ¸…æ·¡': 'ğŸ¥¬ æ¸…æ·¡',
                'çˆ±åƒè¾£': 'ğŸŒ¶ï¸ çˆ±åƒè¾£',
                'çˆ±åƒé…¸': 'ğŸ‹ çˆ±åƒé…¸',
                'çˆ±åƒç”œ': 'ğŸ¯ çˆ±åƒç”œ',
                'åå¥½æ¸…æ·¡': 'ğŸ¥¬ åå¥½æ¸…æ·¡',
                'å–œæ¬¢æµ·é²œ': 'ğŸ¦ å–œæ¬¢æµ·é²œ',
                'é«˜è›‹ç™½': 'ğŸ’ª é«˜è›‹ç™½',
                'ä½è„‚è‚ª': 'ğŸ¥— ä½è„‚è‚ª',
                'é«˜çº¤ç»´': 'ğŸŒ¾ é«˜çº¤ç»´',
                'è¡¥é’™': 'ğŸ¥› è¡¥é’™',
                'è¡¥é“': 'ğŸ©¸ è¡¥é“'
            };
            return labels[tag] || tag;
        }

        function getCookTimeLabel(level) {
            const labels = {
                'easy': 'â±ï¸ ç®€å•',
                'medium': 'â° ä¸­ç­‰',
                'hard': 'â³ å¤æ‚'
            };
            return labels[level] || level;
        }

        function getCategoryIcon(category) {
            const icons = {
                'è”¬èœç±»': 'ğŸ¥¬',
                'è‚‰ç±»': 'ğŸ¥©',
                'è±†åˆ¶å“': 'ğŸ«˜',
                'è°ƒå‘³å“': 'ğŸ§‚',
                'ä¸»é£Ÿ': 'ğŸš',
                'å…¶ä»–': 'ğŸ“¦'
            };
            return icons[category] || 'ğŸ“¦';
        }

        function getSpecialDiet(member) {
            const diets = [];
            if (member.isVegetarian) diets.push('ç´ é£Ÿ');
            if (member.isHalal) diets.push('æ¸…çœŸ');
            if (member.lowOil) diets.push('å°‘æ²¹');
            if (member.lowSalt) diets.push('å°‘ç›');

            return diets.length > 0 ? `
                <div style="margin-bottom: 8px;">
                    ç‰¹æ®Šéœ€æ±‚ï¼š${diets.join('ã€')}
                </div>
            ` : '';
        }

        function resetConfig() {
            document.getElementById('mealPeopleCount').value = '3';
            document.getElementById('dishPattern').value = '3';
            document.getElementById('generateDays').value = '5';
            document.getElementById('nutritionTheme').value = '';
            document.getElementById('tastePreference').value = '';
            document.getElementById('avoidIngredients').value = '';
            updateDishCount();
            showToast('é…ç½®å·²é‡ç½®');
        }

        function showSettings() {
            showToast('è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal(this.id);
                }
            });
        });

        // åˆå§‹åŒ–é¢„è®¾èœå“
        function initializeDefaultDishes() {
            const defaultDishes = [
                { name: 'å®«ä¿é¸¡ä¸', type: 'meat', tasteTags: ['è¾£'], nutritionTags: ['é«˜è›‹ç™½'], ingredients: ['é¸¡èƒ¸è‚‰', 'èŠ±ç”Ÿç±³', 'å¹²è¾£æ¤’', 'è‘±', 'å§œ', 'è’œ'], cookTimeLevel: 'medium', remark: 'é¸¡è‚‰è¦åˆ‡ä¸å¤§å°å‡åŒ€' },
                { name: 'ç³–é†‹é‡Œè„Š', type: 'meat', tasteTags: ['é…¸', 'ç”œ'], nutritionTags: [], ingredients: ['çŒªé‡Œè„Š', 'é’æ¤’', 'èƒ¡èåœ'], cookTimeLevel: 'medium', remark: 'é…¸ç”œæ¯”ä¾‹è¦å¹³è¡¡' },
                { name: 'çº¢çƒ§è‚‰', type: 'meat', tasteTags: ['å’¸', 'ç”œ'], nutritionTags: [], ingredients: ['äº”èŠ±è‚‰', 'å†°ç³–', 'å…«è§’', 'æ¡‚çš®'], cookTimeLevel: 'medium', remark: 'å°ç«æ…¢ç‚–æ›´å…¥å‘³' },
                { name: 'é±¼é¦™è‚‰ä¸', type: 'meat', tasteTags: ['é…¸', 'ç”œ'], nutritionTags: [], ingredients: ['çŒªé‡Œè„Š', 'æœ¨è€³', 'èƒ¡èåœ', 'é’æ¤’'], cookTimeLevel: 'medium', remark: 'è°ƒå‘³æ±æ¯”ä¾‹è¦ç¨³' },
                { name: 'å¯ä¹é¸¡ç¿…', type: 'meat', tasteTags: ['ç”œ'], nutritionTags: [], ingredients: ['é¸¡ç¿…', 'å¯ä¹', 'å§œç‰‡', 'è‘±æ®µ'], cookTimeLevel: 'easy', remark: 'æ”¶æ±è¦å°ç«' },
                { name: 'é»‘æ¤’ç‰›æŸ³', type: 'meat', tasteTags: ['å’¸'], nutritionTags: ['é«˜è›‹ç™½'], ingredients: ['ç‰›é‡Œè„Š', 'æ´‹è‘±', 'é’æ¤’', 'é»‘èƒ¡æ¤’'], cookTimeLevel: 'medium', remark: 'ç‰›è‚‰å…ˆè…Œåˆ¶' },
                { name: 'å£æ°´é¸¡', type: 'meat', tasteTags: ['è¾£'], nutritionTags: [], ingredients: ['é¸¡è…¿è‚‰', 'èŠ±æ¤’', 'è¾£æ¤’æ²¹', 'é»„ç“œ'], cookTimeLevel: 'medium', remark: 'å†°æ°´è¿‡å‡‰æ›´å«©' },
                { name: 'å°ç‚’é»„ç‰›è‚‰', type: 'meat', tasteTags: ['è¾£'], nutritionTags: [], ingredients: ['ç‰›è‚‰', 'å°ç±³è¾£', 'é’æ¤’', 'è’œ'], cookTimeLevel: 'medium', remark: 'å¤§ç«å¿«ç‚’' },
                { name: 'æ¸…è’¸é²ˆé±¼', type: 'meat', tasteTags: ['æ¸…æ·¡'], nutritionTags: ['é«˜è›‹ç™½'], ingredients: ['é²ˆé±¼', 'å§œ', 'è‘±', 'æ–™é…’'], cookTimeLevel: 'easy', remark: 'è’¸8-10åˆ†é’Ÿå³å¯' },
                { name: 'æ°´ç…®é±¼ç‰‡', type: 'meat', tasteTags: ['è¾£'], nutritionTags: [], ingredients: ['è‰é±¼', 'è±†èŠ½', 'èŠ±æ¤’', 'å¹²è¾£æ¤’'], cookTimeLevel: 'medium', remark: 'è–„ç‰‡æ›´å«©' },
                { name: 'è’œæ³¥ç™½è‚‰', type: 'meat', tasteTags: ['è’œé¦™'], nutritionTags: [], ingredients: ['äº”èŠ±è‚‰', 'é»„ç“œ', 'è’œæ³¥'], cookTimeLevel: 'medium', remark: 'åˆ‡ç‰‡è¦è–„' },
                { name: 'æ¢…èœæ‰£è‚‰', type: 'meat', tasteTags: ['å’¸'], nutritionTags: [], ingredients: ['äº”èŠ±è‚‰', 'æ¢…å¹²èœ', 'ç”ŸæŠ½', 'è€æŠ½'], cookTimeLevel: 'hard', remark: 'è’¸åˆ¶æ›´å…¥å‘³' },
                { name: 'ç•ªèŒ„ç‰›è…©', type: 'meat', tasteTags: ['é…¸'], nutritionTags: [], ingredients: ['ç‰›è…©', 'ç•ªèŒ„', 'åœŸè±†', 'èƒ¡èåœ'], cookTimeLevel: 'hard', remark: 'å°ç«æ…¢ç‚–' },
                { name: 'åœŸè±†ç‚–ç‰›è…©', type: 'meat', tasteTags: ['å’¸'], nutritionTags: [], ingredients: ['ç‰›è…©', 'åœŸè±†', 'èƒ¡èåœ', 'æ´‹è‘±'], cookTimeLevel: 'hard', remark: 'è½¯çƒ‚å…¥å‘³' },
                { name: 'é‡‘é’ˆè‡è‚¥ç‰›å·', type: 'meat', tasteTags: ['é²œ'], nutritionTags: [], ingredients: ['è‚¥ç‰›å·', 'é‡‘é’ˆè‡', 'ç”ŸæŠ½', 'èšæ²¹'], cookTimeLevel: 'easy', remark: 'å·ç´§ä¸æ•£' },

                { name: 'åœ°ä¸‰é²œ', type: 'vegetable', tasteTags: ['å’¸'], nutritionTags: ['é«˜çº¤ç»´'], ingredients: ['åœŸè±†', 'èŒ„å­', 'é’æ¤’', 'è’œ'], cookTimeLevel: 'medium', remark: 'é£Ÿæè¦å…ˆè¿‡æ²¹' },
                { name: 'è’œè“‰è¥¿å…°èŠ±', type: 'vegetable', tasteTags: ['æ¸…æ·¡'], nutritionTags: ['é«˜çº¤ç»´'], ingredients: ['è¥¿å…°èŠ±', 'è’œ', 'èƒ¡èåœ'], cookTimeLevel: 'easy', remark: 'ç„¯æ°´æ—¶é—´ä¸å®œè¿‡é•¿' },
                { name: 'é…¸è¾£åœŸè±†ä¸', type: 'vegetable', tasteTags: ['é…¸', 'è¾£'], nutritionTags: ['é«˜çº¤ç»´'], ingredients: ['åœŸè±†', 'å¹²è¾£æ¤’', 'é†‹', 'è‘±'], cookTimeLevel: 'easy', remark: 'è¿‡æ°´å»æ·€ç²‰å£æ„Ÿè„†' },
                { name: 'å‡‰æ‹Œæœ¨è€³', type: 'vegetable', tasteTags: ['æ¸…çˆ½'], nutritionTags: ['é«˜çº¤ç»´'], ingredients: ['æœ¨è€³', 'é»„ç“œ', 'è’œæ³¥', 'é¦™èœ'], cookTimeLevel: 'easy', remark: 'æ³¡å‘å……åˆ†æ›´è„†' },
                { name: 'èšæ²¹ç”Ÿèœ', type: 'vegetable', tasteTags: ['æ¸…æ·¡'], nutritionTags: ['é«˜çº¤ç»´'], ingredients: ['ç”Ÿèœ', 'è’œ', 'èšæ²¹'], cookTimeLevel: 'easy', remark: 'å¿«ç‚’ä¿æŒè„†å«©' },
                { name: 'éº»å©†è±†è…', type: 'vegetable', tasteTags: ['è¾£'], nutritionTags: ['é«˜è›‹ç™½'], ingredients: ['è±†è…', 'è‚‰æœ«', 'è±†ç“£é…±', 'èŠ±æ¤’ç²‰'], cookTimeLevel: 'easy', remark: 'è±†è…è½»æ¨ä¸ç¢' },
                { name: 'é’æ¤’åœŸè±†ç‰‡', type: 'vegetable', tasteTags: ['æ¸…æ·¡'], nutritionTags: ['é«˜çº¤ç»´'], ingredients: ['åœŸè±†', 'é’æ¤’', 'è’œç‰‡'], cookTimeLevel: 'easy', remark: 'åœŸè±†åˆ‡è–„ç‰‡' },
                { name: 'ç‚’ä¸‰ä¸', type: 'vegetable', tasteTags: ['å’¸'], nutritionTags: [], ingredients: ['åœŸè±†', 'èƒ¡èåœ', 'é’æ¤’'], cookTimeLevel: 'easy', remark: 'ç«å€™è¦å¤§' },
                { name: 'éº»é…±è èœ', type: 'vegetable', tasteTags: ['æ¸…æ·¡'], nutritionTags: ['é«˜çº¤ç»´'], ingredients: ['è èœ', 'èŠéº»é…±', 'è’œæ³¥'], cookTimeLevel: 'easy', remark: 'ç„¯æ°´åè¿‡å‡‰' },

                { name: 'ç•ªèŒ„è›‹èŠ±æ±¤', type: 'soup', tasteTags: ['æ¸…æ·¡'], nutritionTags: ['é«˜è›‹ç™½'], ingredients: ['ç•ªèŒ„', 'é¸¡è›‹', 'è‘±'], cookTimeLevel: 'easy', remark: 'æ±¤è‰²é‡‘çº¢é²œäº®' },
                { name: 'ç´«èœè™¾çš®æ±¤', type: 'soup', tasteTags: ['æ¸…æ·¡'], nutritionTags: [], ingredients: ['ç´«èœ', 'è™¾çš®', 'é¸¡è›‹', 'è‘±èŠ±'], cookTimeLevel: 'easy', remark: 'å®¶å¸¸å¿«æ‰‹æ±¤å“' },
                { name: 'ç‰›è‚‰ç²‰ä¸æ±¤', type: 'soup', tasteTags: ['é²œ'], nutritionTags: ['é«˜è›‹ç™½'], ingredients: ['ç‰›è‚‰ç‰‡', 'ç²‰ä¸', 'é¦™èœ', 'èƒ¡æ¤’ç²‰'], cookTimeLevel: 'easy', remark: 'ç²‰ä¸æå‰æ³¡è½¯' },
                { name: 'å—ç“œç²¥', type: 'soup', tasteTags: ['æ¸…æ·¡'], nutritionTags: [], ingredients: ['å—ç“œ', 'å¤§ç±³', 'æ¸æ'], cookTimeLevel: 'easy', remark: 'ç»†è…»ç”œç³¯' },

                { name: 'é¦™è‡æ»‘é¸¡é¥­', type: 'staple', tasteTags: ['é²œ'], nutritionTags: ['é«˜è›‹ç™½'], ingredients: ['é¸¡è…¿è‚‰', 'é¦™è‡', 'ç±³é¥­', 'è‘±å§œè’œ'], cookTimeLevel: 'easy', remark: 'ä¸€é”…å‡ºé¥­ä¸èœ' },
                { name: 'é¸¡è›‹é¥¼', type: 'staple', tasteTags: ['æ¸…æ·¡'], nutritionTags: [], ingredients: ['é¸¡è›‹', 'é¢ç²‰', 'è‘±èŠ±'], cookTimeLevel: 'easy', remark: 'é¢ç³Šè¦ç¨€' }
            ];

            // ä½¿ç”¨æ›´å¯é çš„å›¾ç‰‡æœåŠ¡
            const dishImages = [
                'https://picsum.photos/400/300?random=1001', // å®«ä¿é¸¡ä¸
                'https://picsum.photos/400/300?random=1002',
                'https://picsum.photos/400/300?random=1003',
                'https://picsum.photos/400/300?random=1004',
                'https://picsum.photos/400/300?random=1005',
                'https://picsum.photos/400/300?random=1006',
                'https://picsum.photos/400/300?random=1007',
                'https://picsum.photos/400/300?random=1008',
                'https://picsum.photos/400/300?random=1009',
                'https://picsum.photos/400/300?random=1010',
                'https://picsum.photos/400/300?random=1011',
                'https://picsum.photos/400/300?random=1012',
                'https://picsum.photos/400/300?random=1013',
                'https://picsum.photos/400/300?random=1014',
                'https://picsum.photos/400/300?random=1015',
                'https://picsum.photos/400/300?random=1016',
                'https://picsum.photos/400/300?random=1017',
                'https://picsum.photos/400/300?random=1018',
                'https://picsum.photos/400/300?random=1019',
                'https://picsum.photos/400/300?random=1020',
                'https://picsum.photos/400/300?random=1021',
                'https://picsum.photos/400/300?random=1022',
                'https://picsum.photos/400/300?random=1023',
                'https://picsum.photos/400/300?random=1024',
                'https://picsum.photos/400/300?random=1025',
                'https://picsum.photos/400/300?random=1026',
                'https://picsum.photos/400/300?random=1027',
                'https://picsum.photos/400/300?random=1028',
                'https://picsum.photos/400/300?random=1029',
                'https://picsum.photos/400/300?random=1030'
            ];

            // ä¸ºæ¯ä¸ªèœå“æ·»åŠ å›¾ç‰‡
            defaultDishes.forEach((dish, index) => {
                dish.image = dishImages[index] || `https://picsum.photos/400/300?random=${index + 1000}`;
                dish.condiments = dish.condiments || [];
            });

            dishes = defaultDishes.map((d, i) => normalizeDish(d, i));
            saveDataToStorage();
            updateCounts();
            renderDishes();
        }
    </script>
</body>
</html>
